package tp.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.List;
import java.util.ResourceBundle;

import tp.entity.Personne;

public class PersonneDaoJdbc implements PersonneDAO {

	
	public Connection etablirConnection() {
		Connection cn = null;
		try {
			ResourceBundle ressources = ResourceBundle.getBundle("paramDB") ; // paramDB.properties
			 String driver = ressources.getString("driver");
			 String chUrl = ressources.getString("url");
			 String username = ressources.getString("username"); 
			 String password = ressources.getString("password");
			 Class.forName(driver); cn = DriverManager.getConnection(chUrl,username,password) ;
		} catch (ClassNotFoundException e) {
			System.err.println("le drivr jdbc ne peut pas etre chargé en mémoire, erreur de nom ou bien oubli dans ");
			e.printStackTrace();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} 
		return cn;
	}
	
	@Override
	public Personne createPersonne(Personne p) {
		Connection cn = this.etablirConnection();
		try {
			/*
			Statement st = cn.createStatement();
			String reqSql = "INSERT INTO personne(prenom,nom) VALUES(' "
								+ p.getPrenom() + "','" + p.getNom() + "')";
			int nblignesAffectees = st.executeUpdate(reqSql);
			*/
			PreparedStatement st = cn.prepareStatement("INSERT INTO personne(prenom,nom) VALUES(?,?)",
					Statement.RETURN_GENERATED_KEYS);
			st.setString(1, p.getPrenom());
			st.setString(2, p.getNom());
			int nblignesAffectees = st.executeUpdate();
			System.out.println("nb lignes inserees: " + nblignesAffectees);
			st.close();
			
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return p;
	}

		Integer recupValeurAutoIncrPk(PreparedStatement pst){
		Integer pk=null;
		try {
		 ResultSet rsKeys = pst.getGeneratedKeys();
		 if(rsKeys.next()){ pk= rsKeys.getInt(1) ;  }
		} catch (SQLException e) { e.printStackTrace(); }
		 return pk;
		}


	@Override
	public Personne rechercherPersonneParId(Integer idPers) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public List<Personne> rechercherToutesPersonnes() {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public void updatePersonne(Personne p) {
		// TODO Auto-generated method stub

	}

	@Override
	public void deletePersonne(Integer idPers) {
		// TODO Auto-generated method stub

	}

}
